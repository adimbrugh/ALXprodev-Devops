#!/bin/bash

# Define paths
DATA_DIR="Advanced_shell/pokemon_data"
CSV_FILE="Advanced_shell/pokemon_report.csv"

# Check if data directory exists
if [ ! -d "$DATA_DIR" ]; then
  echo "❌ Directory not found: $DATA_DIR"
  exit 1
fi

# Header for CSV file
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

# Loop through each JSON file and extract data
for file in "$DATA_DIR"/*.json; do
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height_dm=$(jq -r '.height' "$file")
  weight_hg=$(jq -r '.weight' "$file")

  # Convert to meters and kg
  height_m=$(awk "BEGIN { printf \"%.1f\", $height_dm / 10 }")
  weight_kg=$(awk "BEGIN { printf \"%.1f\", $weight_hg / 10 }")

  echo "$name,$height_m,$weight_kg" >> "$CSV_FILE"
done

echo -e "\nCSV Report generated at: $CSV_FILE"
echo ""

# Print the CSV content
cat "$CSV_FILE"

# Calculate averages using awk
awk -F, 'NR>1 { total_h += $2; total_w += $3; count++ }
         END {
           avg_h = total_h / count;
           avg_w = total_w / count;
           printf "\nAverage Height: %.2f m\n", avg_h;
           printf "Average Weight: %.2f kg\n", avg_w;
         }' "$CSV_FILE"
